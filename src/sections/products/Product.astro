---
export interface Producto {
  nombre: string;
  description: string;
  image: string;
}

export interface Props {
  producto: Producto;
  index: number;
  inverted?: boolean;
}

const { producto, index, inverted } = Astro.props as Props;
import { Image } from "astro:assets";
---

<li
  class="flex w-full h-full gap-8 items-center max-md:flex-col-reverse"
  class:list={[
    {
      "flex-row-reverse": inverted,
    },
  ]}
>
  <div class="p-4 flex flex-col gap-2 justify-center h-full md:w-1/3 w-full">
    <h3 class="text-2xl md:text-7xl font-semibold">{producto.nombre}</h3>
    <p class="text-sm md:text-lg text-foreground/70">{producto.description}</p>
  </div>

  <div class="md:w-2/3 w-full relative overflow-hidden h-screen">
    <div class="w-full h-full relative">
      <Image
        width={600}
        height={800}
        data-index={index}
        src={producto.image}
        alt={producto.nombre}
        class="product-image w-full h-full object-cover absolute inset-0"
      />
    </div>
  </div>
</li>

<script>
  import { gsap } from "gsap";
  import ScrollTrigger from "gsap/ScrollTrigger";
  gsap.registerPlugin(ScrollTrigger);

  const onReady = () => {
    const containers = document.querySelectorAll(".product-image");

    containers.forEach((container) => {
      const img =
        container.querySelector(".pi-img") || container.querySelector("img");
      if (!img) return;

      const startAnim = () => {
        gsap.fromTo(
          img,
          { yPercent: 6, scale: 1.06, opacity: 0 },
          {
            yPercent: -6,
            scale: 1,
            opacity: 1,
            ease: "none",
            scrollTrigger: {
              trigger: container,
              start: "top 70%",
              end: "+=500",
              scrub: 0.6,
              // markers: true,
            },
          },
        );
      };

      // ensure we have an HTMLImageElement to check load state
      if (!(img instanceof HTMLImageElement)) {
        startAnim();
        return;
      }

      if (
        container.classList.contains("loaded") ||
        (img.complete && img.naturalWidth !== 0)
      ) {
        startAnim();
      } else {
        img.addEventListener("load", startAnim, { once: true });
        img.addEventListener("error", startAnim, { once: true });
      }
    });
  };

  if (document.readyState === "complete") onReady();
  else window.addEventListener("load", onReady);
</script>
